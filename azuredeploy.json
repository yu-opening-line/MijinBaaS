{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "2nd_location": {
        "type": "string",
        "allowedValues": [
          "West India",
          "Central India",
          "South India",
          "Australia East",
          "Australia Southeast",
          "Canada East",
          "Canada Central",
          "Brazil South",
          "West Europe",
          "North Europe",
          "UK West",
          "UK South",
          "Korea Central",
          "Korea South",
          "Japan West",
          "East Asia",
          "Southeast Asia",
          "Japan East",
          "West US",
          "West US 2",
          "Central US",
          "West Central US",
          "South Central US",
          "North Central US",
          "East US",
          "East US 2"
        ],
        "metadata": {
          "description": "Select 2nd Mijin Server Location."
        }
    },
    "3rd_location": {
      "type": "string",
      "allowedValues": [
        "West India",
        "Central India",
        "South India",
        "Australia East",
        "Australia Southeast",
        "Canada East",
        "Canada Central",
        "Brazil South",
        "West Europe",
        "North Europe",
        "UK West",
        "UK South",
        "Korea Central",
        "Korea South",
        "Japan West",
        "East Asia",
        "Southeast Asia",
        "Japan East",
        "West US",
        "West US 2",
        "Central US",
        "West Central US",
        "South Central US",
        "North Central US",
        "East US",
        "East US 2"
      ],
      "metadata": {
        "description": "Select 3rd Mijin Server Location."
      }
    },
    "4th_location": {
      "type": "string",
      "allowedValues": [
        "West India",
        "Central India",
        "South India",
        "Australia East",
        "Australia Southeast",
        "Canada East",
        "Canada Central",
        "Brazil South",
        "West Europe",
        "North Europe",
        "UK West",
        "UK South",
        "Korea Central",
        "Korea South",
        "Japan West",
        "East Asia",
        "Southeast Asia",
        "Japan East",
        "West US",
        "West US 2",
        "Central US",
        "West Central US",
        "South Central US",
        "North Central US",
        "East US",
        "East US 2"
      ],
      "metadata": {
        "description": "Select 4th Mijin Server Location."
      }
    },
    "1st_server_admin_password": {
        "type": "secureString",
        "minLength": 12,
        "maxLength": 72,
        "metadata": {
          "description": "Password for the 1st Mijin Server. Passwords must be between 12 and 72 characters and have 3 of the following: 1 lower case, 1 upper case, 1 number, and 1 special character."
        }
    },
    "2nd_server_admin_password": {
        "type": "secureString",
        "minLength": 12,
        "maxLength": 72,
        "metadata": {
          "description": "Password for the 2nd Mijin Server. Passwords must be between 12 and 72 characters and have 3 of the following: 1 lower case, 1 upper case, 1 number, and 1 special character."
        }
    },
    "3rd_server_admin_password": {
        "type": "secureString",
        "minLength": 12,
        "maxLength": 72,
        "metadata": {
          "description": "Password for the 3rd Mijin Server. Passwords must be between 12 and 72 characters and have 3 of the following: 1 lower case, 1 upper case, 1 number, and 1 special character."
        }
    },
    "4th_server_admin_password": {
        "minLength": 12,
        "maxLength": 72,
        "type": "secureString",
        "metadata": {
          "description": "Password for the 4th Mijin Server. Passwords must be between 12 and 72 characters and have 3 of the following: 1 lower case, 1 upper case, 1 number, and 1 special character."
        }
    },
    "mijin_vm_prefix": {
        "type": "String",
        "minLength": 1,
        "metadata": {
          "description": "Unique Server Name."
        }
    },
    "additional_local_IPs": {
        "type": "String",
        "metadata": {
          "description": "Set the Local IP Address to issue the Mijin Account. For more than one, enter with pipe break. (XX.XX.XX.XX | XX.XX.XX.XX)"
        }
    }
  },
  "variables": {
    "VM_DEPLOY_JSON_URL"  : "https://raw.githubusercontent.com/yu000/MijinBaaS/master/vmdeploy.json",
    "MIJIN_INSTALL_SH_URL": "https://raw.githubusercontent.com/yu000/MijinBaaS/master/scripts/install_mijin.sh",
    "MIJIN_INSTALLER_URL" : "https://raw.githubusercontent.com/yu000/MijinBaaS/master/scripts/m.tar.gz",
    "location0": "[resourceGroup().location]",
    "location1": "[parameters('2nd_location')]",
    "location2": "[parameters('3rd_location')]",
    "location3": "[parameters('4th_location')]",
    "adminPassword0": "[parameters('1st_server_admin_password')]",
    "adminPassword1": "[parameters('2nd_server_admin_password')]",
    "adminPassword2": "[parameters('3rd_server_admin_password')]",
    "adminPassword3": "[parameters('4th_server_admin_password')]",
    "base_vm_name": "[concat(parameters('mijin_vm_prefix'),'-mijin-vm')]"
  },
  "resources": [
    {
      "name": "[concat('mijindeploy', copyIndex())]",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2017-05-10",
      "dependsOn": [],
      "properties": {
        "mode": "Incremental",
        "templateLink": {
          "uri": "[variables('VM_DEPLOY_JSON_URL')]",
          "contentVersion": "1.0.0.0"
        },
        "parameters": {
          "location": {
            "value": "[variables(concat('location', copyIndex()))]"
          },
          "adminPassword": {
            "value": "[variables(concat('adminPassword', copyIndex()))]"
          },
          "mijin_vm_prefix": {
            "value": "[parameters('mijin_vm_prefix')]"
          },
          "mijin_vm_number": {
              "value": "[copyIndex()]"
          }
        }
      },
      "copy": {
        "name"  : "vm_deploy_copy",
        "count" : 1
      }
    }
  ],
  "outputs": {
  }
}
